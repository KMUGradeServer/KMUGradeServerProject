{%- extends "main.html" -%}
{%- block body %}
<script>
$(function() {
	var ownCourses = [
		{%- for course in ownCourses %}
		{ value: "{{ course.courseId }} {{ course.courseName }}" },
		{% endfor -%}
		{ value : ""}
	];
	var members = [
		{%- for eachUser in allUsers %}
			{ value: "{{ eachUser[0] }} {{ eachUser[1] }}", data: "{% for eachData in eachUser %}{{ eachData }} {% endfor %}"},
		{% endfor -%}
		{ value: "", data: "" }
	];
	$("#search-courses").autocomplete({
		lookup: ownCourses,
		onSelect: function(suggestion){

		}
	});
	$("#search-members").autocomplete({
		lookup: members,
		onSelect: function(suggestion){
			memberDatas = (suggestion.data).split(" ");
			memberId = memberDatas[0];
			memberName = memberDatas[1];
			memberDepartments = ""
			for(var $i = 2;$i < memberDatas.length - 1;$i += 2){
				if($i > 3) memberDepartments += "<br>"; /* if more colleges and departments,then change the line */
				{% for college in colleges %}
					if(memberDatas[$i] == {{ college.collegeIndex }}){
						memberDepartments += "{{ college.collegeName }} ";
					}
				{% endfor %}
				{% for department in departments %}
					if(memberDatas[$i + 1] == {{ department.departmentIndex }}){
						memberDepartments += "{{ department.departmentName }} ";
					}
				{% endfor %}
			}
			$("#search-members").attr("value", memberId);
			$("#member-name").html(memberName);
			$("#department-name").html(memberDepartments);
    }
	});
});
</script>
<div class="container">
	<div>
		<h3>Add User</h3>
		<!-- if any button is checked, then showing modal pop -->
		<div style="text-align:right">
			<a class="btn" data-toggle="modal" href="#addUserModal" rol="button">Add</a>
			<a class="btn" data-toggle="modal" role="button" onclick="showingDeleteModal()">Delete</a>
		</div>

		<!-- hidden modal pop -->
		<div class="modal hide fade" id="addUserModal" role="dialog" aria-labelledby="addUserModalLabel" aria-hidden="true" tabindex="-1">
			<div class="modal-header">
				<button class="close" data-dismiss="modal" type="button" aria-hidden="true">x</button>
				<h3 id="addUserModalLabel">Add User</h3>
			</div>
			<div class="modal-body">
				<div style="text-align:right"><button class="btn" type="button">Add line</button></div>
				<table class="table table-bordered" style="margin-top:10px">
					<thead>
						<tr>
							<td>Course Id
							<td>User Id
							<td>User Name
							<td>Department
					<tbody>
						<tr>
							<td><div id="searchfield"><input class="input-ularge" id="search-courses" name="courseId" type="text" value="" form="addUser"></div>
							<td><div id="searchfield"><input class="input-ularge" id="search-members" name="memberId" type="text" value="" form="addUser"></div>
							<td id="member-name">
							<td id="department-name">
				</table>
			</div>
			<div class="modal-footer">
				<form id="addUser" method="post">
					<button class="btn" type="submit">Done</button>
					<button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
				</form>
			</div>
		</div>
		<!-- if any item choiced -->
		<div class="modal hide fade" id="deleteModal" aria-labelledby="deleteModalLabel" aria-hidden="true" role="dialog" tabindex="-1">
			<div class="modal-header">
				<button class="close" type="button" data-dismiss="modal" aria-hidden="true">x</button>
				<h3 id="deleteModalLabel">Delete User</h3>
			</div>
			<div class="modal-body">
				<p>Do you really want to delete it?</p>
			</div>
			<div class="modal-footer">
				<form id="deleteUser" method="post">
					<button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
					<button class="btn" type="submit">Done</button>
				</form>
			</div>
		</div>
		<!-- no items choiced -->
		<div class="modal hide fade" id="deleteNoItem" role="dialog" aria-labelledby="deleteModalLabel" aria-hidden="true" tabindex="-1">
			<div class="modal-header">
				<button class="close" type="button" data-dismiss="modal" aria-hidden="true">x</button>
				<h3 id="deleteModalLabel">Delete User</h3>
			</div>
			<div class="modal-body">
				<p>No items choiced</p>
			</div>
			<div class="modal-footer">
				<button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
			</div>
		</div>
		<!-- end hidden modal pop -->

		<table class="table table-bordered" style="margin-top:10px">
			<thead>
				<tr>
					<td>Index
					<td>Course
					<td>User Id
					<td>User Name
					<td>Department
					<td>Delete
			<tbody>
				{% for eachUser in ownUsers %}
				<tr>
					<td>{{ loop.index }}
					<td>{{ eachUser[0] }} <!-- courseId -->
					<td>{{ eachUser[1] }} <!-- userId -->
					<td>{{ eachUser[2] }} <!-- userName -->
					<td> <!-- college departments list -->
						{% for index in range(3, eachUser|length) %}
							{{ eachUser[index] }}
							{% if index%2==0 %}
							<br>
							{% endif %}
						{% endfor %}
					<td><label class="checkbox-center"><input class="box-check" name="delete_{{ eachUser[0] }}_{{ eachUser[1] }}" type="checkbox" form="deleteUser"></label>
				{% endfor %}
		</table>
	</div>
</div>
{% endblock -%}
